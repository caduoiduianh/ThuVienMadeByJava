<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Trả sách</title>
</head>
<body>
<h1>Trả sách</h1>

<!-- Bước 1: nhập tên + phone -->
<form th:action="@{/return}" th:object="${returnForm}" method="post"
      th:if="${step == null}">
    <p>
        Họ tên:
        <input type="text" th:field="*{readerName}" required>
    </p>
    <p>
        Số điện thoại:
        <input type="text" th:field="*{phone}" required>
    </p>
    <button type="submit">Tìm sách đang mượn</button>
</form>

<!-- Bước 2: hiện danh sách sách và chọn để trả -->
<form th:action="@{/return}" th:object="${returnForm}" method="post"
      th:if="${step == 2}">
    <input type="hidden" th:field="*{readerName}">
    <input type="hidden" th:field="*{phone}">
    <p>Chọn sách muốn trả:</p>
    <ul>
        <li th:each="loan : ${loans}">
            <label>
                <input type="checkbox" name="selectedLoanIds"
                       th:value="${loan.id}">
                <span th:text="${loan}"></span>
            </label>
        </li>
    </ul>
    <button type="submit">Xác nhận trả</button>
</form>

<div th:if="${error}">
    <p th:text="${error}" style="color: red;"></p>
</div>

<div th:if="${done}">
    <p th:text="${allOk} ? 'Trả sách thành công.' : 'Một số sách không trả được.'"></p>
</div>

<p><a href="/">Về trang chủ</a></p>
</body>
</html>
